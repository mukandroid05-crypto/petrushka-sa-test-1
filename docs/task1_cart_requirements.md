# Задание 1: Анализ требований — "Корзина"

## 1) Логические противоречия и недочёты исходного ТЗ

Ниже перечислены проблемы в исходных пунктах 1–13 (в исходнике отсутствует пункт 12).

| Пункт | Проблема | Почему это критично | Конкретное исправление |
|---|---|---|---|
| 1 | "Добавить от 1 до 10 единиц" — неясно, это лимит на одну операцию добавления или на итоговое количество SKU в корзине | Разные трактовки дадут разные реализации фронта/бэка (кнопка “Добавить”, степпер количества) | Зафиксировать: лимит 1..10 — это итоговое количество единиц **одного SKU в корзине** |
| 2 | Указан минимум (не менее 1), но не указан максимум (до 10) | Пользователь сможет выставить количество >10 и нарушить п.1 | Указать диапазон изменения количества 1..10 |
| 2 vs 9 | П.2: количество не менее 1, удаление отдельной кнопкой. П.9: уменьшение до 0 удаляет товар | Взаимоисключающие правила удаления, невозможно реализовать одновременно | Выбрать одно правило: либо удаление только кнопкой (0 запрещён), либо 0 разрешён и удаление через 0; закрепить в ТЗ |
| 3 | "не более 5 различных товаров" — не определено “различный” (SKU? товар без учёта вариантов? упаковка?) | Нельзя корректно считать лимит, появятся спорные кейсы (разные фасовки, варианты) | Определить “различный товар” как **уникальный SKU** |
| 3 | Не описано, что делать при попытке добавить 6-й SKU | UX и поведение системы будут “на усмотрение разработчика” | Описать: отклонить действие и показать причину превышения лимита |
| 4 | Суммарный лимит 20 не описан для сценария изменения количества в корзине | Можно обойти лимит, если проверка только при добавлении | Зафиксировать: лимит проверяется и при добавлении, и при изменении количества |
| 5 | "Товары в корзине могут быть разные" — не несёт требований, дублирует смысл п.3 | Шум в ТЗ, снижает точность | Удалить пункт или заменить на полезную формулировку (например про типы товаров/SKU) |
| 6 | Одно сообщение "Лимит корзины превышен" для разных ограничений | Пользователь не понимает, какой лимит нарушен; сложно тестировать | Добавить код причины или уточняющий текст (какой лимит превышен) |
| 7 vs 13 | П.7 фиксирует цену на момент добавления и не меняет. П.13 требует автоматически обновлять цену | Прямое противоречие | Выбрать единое правило ценообразования (см. исправленное ТЗ ниже) |
| 8 | Не указано, какую цену показывать: фиксированную или актуальную; нет правил округления | Разные реализации дадут разные суммы и расхождения с чеками | Явно определить источник цены для расчёта и правила отображения/округления |
| 9 | Удаление по 0 противоречит п.2 и не описан ручной ввод 0 | Неопределённость UI и валидации | Запретить 0 (если удаление кнопкой) или разрешить 0 и убрать отдельную кнопку |
| 10 | "может быть реклама" — не определено место, формат, количество, действие по клику | Нельзя оценить/разработать/протестировать | Определить слот, количество карточек, поведение по клику |
| 11 | "каждый будний день по утрам и вечерам" — нет времени, часового пояса, что именно должно происходить | Непроверяемое требование, разные трактовки | Зафиксировать расписание (например 09:00 и 18:00), часовой пояс и что “обновляется контент” |
| 13 | "обновить у всех пользователей" — не определено как/когда (пуш, фоновая задача, при открытии), что с кешем | Дорого, неоднозначно, сложно гарантировать | Определить механизм: обновление при следующем запросе корзины или через события с инвалидацией |

Доп. дефект: пропущен пункт **12** (ошибка нумерации/редакции документа).

---

## 2) Исправленная версия фрагмента ТЗ (логически завершённая)

Ниже — согласованная версия без противоречий.  
Решение по цене: в корзине для расчёта используется **актуальная цена**, но хранится и **цена на момент добавления** (для истории и сообщения “цена изменилась”).

### Термины
- **SKU** — уникальная позиция товара (товар + вариант/упаковка).
- **Позиция корзины** — запись: SKU + количество + цены.
- **Каталог** — система-источник актуальных цен.

### Ограничения
1. Количество единиц одного SKU в корзине: **от 1 до 10**.
2. В корзине может находиться не более **5 различных SKU**.
3. Суммарное количество всех товаров в корзине не может превышать **20** единиц.

### Операции
4. Добавление товара:
   - если SKU отсутствует в корзине — создаётся позиция с количеством 1;
   - если SKU уже есть — увеличивается количество;
   - при добавлении выполняется проверка ограничений (пп.1–3); при нарушении — действие отклоняется.
5. Изменение количества:
   - пользователь может изменить количество позиции только в диапазоне **1..10**;
   - изменение количества также проверяет ограничения (пп.2–3);
   - значение **0 запрещено**.
6. Удаление товара:
   - удаление позиции выполняется только кнопкой **"Удалить"**;
   - после удаления корзина пересчитывается.

### Обработка превышения лимитов
7. При попытке добавить/изменить количество с нарушением ограничений система:
   - показывает сообщение: **"Лимит корзины превышен"**,
   - и возвращает причину (для UI и тестирования) одним из кодов:
     - `ITEM_QTY_LIMIT` — превышен лимит 10 единиц на SKU
     - `DISTINCT_ITEMS_LIMIT` — превышен лимит 5 различных SKU
     - `TOTAL_QTY_LIMIT` — превышен лимит 20 единиц суммарно

### Цена
8. Для каждой позиции корзины хранится:
   - `priceAdded` — цена на момент добавления в корзину,
   - `priceCurrent` — актуальная цена из каталога.
9. Стоимость позиции и итог корзины рассчитываются по `priceCurrent`.
10. При получении корзины и при каждом изменении её состава система:
   - получает актуальные цены из каталога,
   - обновляет `priceCurrent`,
   - пересчитывает суммы.
11. Если `priceCurrent` изменился относительно ранее показанного значения, пользователь видит уведомление **"Цена изменилась"** (без блокировки действий).

### Отображение
12. На странице корзины отображаются:
   - список позиций,
   - количество (1..10),
   - цена за единицу (`priceCurrent`),
   - стоимость позиции (`priceCurrent * qty`),
   - итог по корзине.

### Реклама/рекомендации
13. В корзине отображается блок рекомендаций/рекламы:
   - размещение: **после списка товаров**,
   - количество: до **N** карточек (значение N согласовать),
   - по клику: открытие карточки товара в приложении (или внешний URL — по согласованию),
   - контент блока обновляется по будням **в 09:00 и 18:00** по локальному времени пользователя (или согласованному часовому поясу).

---

## 3) Уточняющие вопросы к продукту/бизнесу

### Лимиты и сценарии
1. Лимит 1..10 — это итоговое количество SKU в корзине или лимит на одну операцию добавления?
2. “Различные товары” — это именно SKU (товар+вариант/упаковка) или что-то другое?
3. Что делать, если пользователь пытается добавить 6-й SKU: запретить или предложить заменить/удалить?
4. Нужно ли в UI показывать точную причину превышения лимита (какой именно лимит)?
5. Разрешён ли ручной ввод количества в поле? Какие правила для некорректных значений?

### Цена
6. Какая бизнес-логика при изменении цены: корзина всегда по актуальной цене или фиксируется до оформления?
7. Нужно ли требовать подтверждение пользователя при изменении цены перед оформлением заказа?
8. Что делать с товарами, которые стали недоступны/сняты с продажи после добавления?

### Реклама
9. Реклама в корзине — это монетизация (баннеры/партнёрка) или рекомендации (cross-sell)?
10. В какие точные интервалы “утро/вечер” и в каком часовом поясе? Это обновление контента или обязательный показ?
11. Клик по рекламе ведёт во внутреннюю карточку товара или на внешний ресурс?

### Аналитика/прочее
12. Нужны ли события аналитики: add_to_cart, remove_from_cart, limit_exceeded, price_changed?
13. Есть ли требования к округлению цен, валюте, скидкам/промокодам в корзине?
